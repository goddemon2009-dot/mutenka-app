<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://unpkg.com/tesseract.js@v2.1.4/dist/tesseract.min.js"></script>
    
    <style type="text/tailwindcss">
        .active-tab { border-bottom: 4px solid #10b981; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .menu-btn { @apply flex flex-col items-center; }
        .image-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        #reader { width: 100%; border-radius: 24px; overflow: hidden; }
        summary { cursor: pointer; list-style: none; }
    </style>
</head>
<body id="body" class="bg-gray-100 text-gray-900 font-sans">
    <header class="bg-emerald-600 text-white p-4 shadow-md">
        <h1 class="text-xl font-bold">ã“ã ã‚ã‚Šã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯</h1>
    </header>

    <main class="p-4 max-w-md mx-auto">
        <div id="section-home" class="grid grid-cols-1 gap-6 pt-10 text-center">
            <button onclick="startCameraMode()" class="menu-btn bg-blue-600 text-white shadow-blue-200">
                <span class="text-4xl mb-2">ğŸ“¸</span>
                <span class="font-bold text-lg">ã‚«ãƒ¡ãƒ©ã§ã‚¹ãƒãƒ¼ãƒˆå…¥åŠ›</span>
                <span class="text-[10px] opacity-80 text-white/80">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ»ã‚ã‚‰ã‚†ã‚‹å•†å“ã«å¯¾å¿œ</span>
            </button>
            <button onclick="startManualMode()" class="menu-btn bg-white text-emerald-700 border-2 border-emerald-100">
                <span class="text-4xl mb-2">ğŸ“</span>
                <span class="font-bold text-lg">è©³ç´°å…¥åŠ›ãƒ»æ€ã„å‡ºã‚’è¨˜éŒ²</span>
            </button>
            <button onclick="startBrowseMode()" class="menu-btn bg-emerald-500 text-white shadow-emerald-200">
                <span class="text-4xl mb-2">ğŸ‘€</span>
                <span class="font-bold text-lg">ã¿ã‚“ãªã®è¨˜éŒ²ã‚’è¦‹ã‚‹</span>
            </button>
        </div>

        <div id="section-camera" class="hidden"><div id="reader" class="shadow-2xl"></div><button onclick="goHome()" class="w-full py-3 bg-gray-400 text-white rounded-xl font-bold">Ã— æˆ»ã‚‹</button></div>

        <div id="section-form" class="hidden bg-white p-6 rounded-3xl shadow-sm border border-gray-200">
            <div class="flex justify-between items-center mb-6">
                <h2 id="form-title" class="text-lg font-bold text-emerald-700">ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                <button onclick="goBackFromForm()" class="text-gray-400 font-bold">Ã— æˆ»ã‚‹</button>
            </div>
            
            <div class="space-y-4 text-left">
                <div class="grid grid-cols-2 gap-2">
                    <select id="author" class="p-2.5 border rounded-xl bg-gray-50 text-sm font-bold">
                        <option value="ã—ã‚‡ã†ã‚„">ğŸ‘¤ ã—ã‚‡ã†ã‚„</option>
                        <option value="ã˜ã‚…ã‚“ã“">ğŸ‘© ã˜ã‚…ã‚“ã“</option>
                        <option value="ãµã¿ã²ã“">ğŸ‘¨ ãµã¿ã²ã“</option>
                    </select>
                    <select id="input-category" onchange="toggleCategoryFields(this.value)" class="p-2.5 border-2 border-blue-100 rounded-xl bg-blue-50 text-xs font-bold text-blue-700">
                        <option value="gourmet">ğŸ´ ã‚°ãƒ«ãƒ¡</option>
                        <option value="item">ğŸ§´ èª¿å‘³æ–™ãƒ»æ—¥ç”¨å“</option>
                        <option value="hotel">ğŸ¨ ãƒ›ãƒ†ãƒ«</option>
                        <option value="sushi">ğŸ£ å¯¿å¸</option>
                    </select>
                </div>

                <div class="flex gap-2">
                    <input type="text" id="name" placeholder="åç§°ï¼ˆåº—åãƒ»å•†å“åï¼‰" class="w-full p-3 border rounded-xl font-bold shadow-sm">
                    <button onclick="magicSearch('name')" id="location-magic-btn" class="bg-blue-500 text-white px-3 rounded-xl text-[10px] font-bold shadow-md whitespace-nowrap active:scale-95">ğŸ” ä½æ‰€æ¤œç´¢</button>
                    <button onclick="searchJAN()" id="jan-search-btn" class="hidden bg-orange-500 text-white px-3 rounded-xl text-[10px] font-bold whitespace-nowrap">ğŸ” WEBæ¤œç´¢</button>
                </div>

                <div id="field-phone" class="flex gap-2">
                    <input type="tel" id="phone" placeholder="é›»è©±ç•ªå·" class="w-full p-3 border rounded-xl text-sm">
                    <button onclick="magicSearch('phone')" class="bg-indigo-500 text-white px-3 rounded-xl text-[10px] font-bold shadow-md whitespace-nowrap active:scale-95">ğŸ“ ç•ªå·æ¤œç´¢</button>
                </div>

                <div id="fields-sushi" class="hidden space-y-2 bg-red-50 p-3 rounded-xl border border-red-100">
                    <input type="text" id="sushi-fish" placeholder="ã•ã‚‰ã«è©³ã—ã„ãƒã‚¿æƒ…å ±ï¼ˆçœŸã„ã‹ç­‰ï¼‰" class="w-full p-2 text-xs border rounded-lg bg-white">
                    <input type="text" id="sushi-vinegar" placeholder="ã‚·ãƒ£ãƒªãƒ»å‘³ä»˜ã‘ï¼ˆèµ¤é…¢ã€å¡©ãªã©ï¼‰" class="w-full p-2 text-xs border rounded-lg bg-white">
                </div>

                <div id="fields-hotel" class="hidden space-y-2 bg-indigo-50 p-3 rounded-xl border border-indigo-100">
                    <input type="text" id="hotel-interior" placeholder="ãŠéƒ¨å±‹ãƒ»å†…è£…ã®æ„Ÿæƒ³" class="w-full p-2 text-xs border rounded-lg bg-white">
                    <input type="text" id="hotel-meal" placeholder="é£Ÿäº‹ã®æ„Ÿæƒ³" class="w-full p-2 text-xs border rounded-lg bg-white">
                </div>

                <div id="fields-comparison" class="hidden space-y-3">
                    <div id="price-entry-list" class="space-y-3"></div>
                    <button onclick="addPriceField()" class="w-full py-2 bg-orange-50 text-orange-600 border border-orange-200 rounded-xl text-xs font-bold">+ è³¼å…¥å…ˆãƒ»ä¾¡æ ¼ã‚’è¿½åŠ </button>
                </div>

                <div id="field-location-container">
                    <input type="text" id="location" placeholder="ä½æ‰€" class="w-full p-3 border rounded-xl text-sm">
                </div>
                
                <div id="fields-rating" class="bg-yellow-50 p-3 rounded-xl border border-yellow-100">
                    <label class="text-[10px] font-bold text-yellow-600">æº€è¶³åº¦ (â˜…1-5)</label>
                    <input type="range" id="rating-val" min="1" max="5" value="3" class="w-full accent-yellow-500">
                </div>

                <div id="field-url-container">
                    <input type="url" id="itemUrl" placeholder="ğŸ”— é€šè²©ãƒ»å…¬å¼ã‚µã‚¤ãƒˆURL" class="w-full p-3 border border-blue-100 rounded-xl text-sm bg-blue-50/20">
                </div>
                
                <div class="p-4 border-2 border-dashed border-emerald-100 rounded-xl bg-emerald-50/20">
                    <input type="file" id="photo" accept="image/*" multiple class="text-xs w-full" onchange="processOCR(this)">
                    <div id="ocr-status" class="text-[9px] text-blue-600 font-bold mt-2"></div>
                </div>

                <textarea id="memo" placeholder="ã“ã ã‚ã‚Šãƒ¡ãƒ¢" class="w-full p-3 border rounded-xl h-24 text-sm"></textarea>
                <input type="hidden" id="barcode-val">
                
                <button onclick="saveData()" id="save-btn" class="w-full bg-emerald-500 text-white py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-all">ä¿å­˜ã—ã¦åŒæœŸ</button>
            </div>
        </div>

        <div id="section-browse" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <button onclick="goHome()" class="text-emerald-700 font-bold text-sm">â† æˆ»ã‚‹</button>
                <input type="text" id="searchInput" oninput="displayData()" placeholder="ğŸ” æ¤œç´¢..." class="p-2 border rounded-full text-xs w-1/2 outline-none bg-white shadow-sm">
            </div>
            <nav class="flex overflow-x-auto gap-2 mb-6 no-scrollbar border-b pb-2 font-bold">
                <button onclick="switchTab('gourmet')" id="tab-gourmet" class="px-3 py-1 whitespace-nowrap active-tab text-sm">ã‚°ãƒ«ãƒ¡</button>
                <button onclick="switchTab('item')" id="tab-item" class="px-3 py-1 whitespace-nowrap text-sm text-gray-400">èª¿å‘³æ–™ãƒ»æ—¥ç”¨å“</button>
                <button onclick="switchTab('hotel')" id="tab-hotel" class="px-3 py-1 whitespace-nowrap text-sm text-gray-400">ãƒ›ãƒ†ãƒ«</button>
                <button onclick="switchTab('sushi')" id="tab-sushi" class="px-3 py-1 whitespace-nowrap text-sm text-gray-400">å¯¿å¸</button>
            </nav>
            <div id="list-container" class="space-y-6 pb-20 font-bold"></div>
        </div>
    </main>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDONjnOEGSzrN3rx-Hhlcq5ew67FTPzvbI", authDomain: "mutenka-app.firebaseapp.com", databaseURL: "https://mutenka-app-default-rtdb.firebaseio.com", projectId: "mutenka-app", storageBucket: "mutenka-app.firebasestorage.app", messagingSenderId: "69649285337", appId: "1:69649285337:web:47d607b94f3331eeca3ec8" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database(), storage = firebase.storage();
        let currentTab = 'gourmet', editingId = null;

        function goHome() { ['section-home', 'section-form', 'section-browse', 'section-camera'].forEach(id => document.getElementById(id).classList.add('hidden')); document.getElementById('section-home').classList.remove('hidden'); resetForm(); }
        function goBackFromForm() { if (editingId) startBrowseMode(); else goHome(); resetForm(); }
        function startManualMode() { if (!editingId) resetForm(); document.getElementById('section-home').classList.add('hidden'); document.getElementById('section-browse').classList.add('hidden'); document.getElementById('section-form').classList.remove('hidden'); toggleCategoryFields(document.getElementById('input-category').value); }
        function startBrowseMode() { document.getElementById('section-home').classList.add('hidden'); document.getElementById('section-form').classList.add('hidden'); document.getElementById('section-browse').classList.remove('hidden'); displayData(); }

        async function magicSearch(type) {
            const query = type === 'name' ? document.getElementById('name').value : document.getElementById('phone').value;
            if (!query) return alert("å…¥åŠ›ã—ã¦ãã ã•ã„");
            if (type === 'phone') { window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank'); return; }
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ' æ—¥æœ¬')}&countrycodes=jp&limit=1`);
                const data = await res.json();
                if (data && data.length > 0) document.getElementById('location').value = data[0].display_name;
                else window.open(`https://www.google.com/search?q=${encodeURIComponent(query + ' ä½æ‰€')}`, '_blank');
            } catch (e) { window.open(`https://www.google.com/search?q=${encodeURIComponent(query + ' ä½æ‰€')}`, '_blank'); }
        }

        function toggleCategoryFields(cat) {
            document.getElementById('fields-sushi').classList.toggle('hidden', cat !== 'sushi');
            document.getElementById('fields-hotel').classList.toggle('hidden', cat !== 'hotel');
            document.getElementById('fields-comparison').classList.toggle('hidden', cat !== 'item');
            
            // ã€é‡è¦ã€‘å¯¿å¸ã‚¿ã‚°ã®ã¿ã®ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«
            document.getElementById('field-phone').classList.toggle('hidden', cat === 'sushi' || cat === 'item');
            document.getElementById('location-magic-btn').classList.toggle('hidden', cat === 'sushi' || cat === 'item');
            document.getElementById('field-url-container').classList.toggle('hidden', cat === 'sushi' || cat === 'item');

            const nameField = document.getElementById('name');
            const locField = document.getElementById('location');
            if (cat === 'sushi') {
                nameField.placeholder = "ãƒã‚¿ã®ç¨®é¡ï¼ˆä¾‹ï¼šã„ã‹ï¼‰";
                locField.placeholder = "ãŠåº—ã®åå‰ï¼ˆä¾‹ï¼šé¼“éŸ¿ï¼‰";
            } else {
                nameField.placeholder = "åç§°ï¼ˆåº—åãƒ»å•†å“åï¼‰";
                locField.placeholder = "å ´æ‰€ãƒ»ä½æ‰€";
            }
            document.getElementById('jan-search-btn').classList.toggle('hidden', !document.getElementById('barcode-val').value);
        }

        function addPriceField(data = {}) {
            const container = document.getElementById('price-entry-list');
            const id = Date.now();
            const div = document.createElement('div');
            div.className = 'p-3 bg-orange-50/50 rounded-xl border border-orange-100 space-y-2 relative';
            div.innerHTML = `<button onclick="this.parentElement.remove()" class="absolute top-1 right-2 text-orange-300">Ã—</button><input type="text" placeholder="è³¼å…¥å…ˆï¼ˆAmazonç­‰ï¼‰" class="shop-name w-full p-2 text-xs border rounded-lg font-bold" value="${data.shop || ''}"><div class="flex gap-2"><input type="text" placeholder="URL" class="shop-loc w-full p-2 text-[10px] border rounded-lg" value="${data.loc || ''}"><input type="number" placeholder="ä¾¡æ ¼" class="shop-price w-24 p-2 text-xs border rounded-lg font-bold" value="${data.price || ''}"></div>`;
            container.appendChild(div);
        }

        async function saveData() {
            const name = document.getElementById('name').value.trim();
            if (!name) return alert('åç§°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            const saveBtn = document.getElementById('save-btn');
            saveBtn.disabled = true; saveBtn.innerText = "åŒæœŸä¸­...";
            try {
                const prices = [];
                document.querySelectorAll('#price-entry-list > div').forEach(el => {
                    prices.push({ shop: el.querySelector('.shop-name').value, loc: el.querySelector('.shop-loc').value, price: el.querySelector('.shop-price').value });
                });
                const photoFiles = document.getElementById('photo').files;
                let imageUrls = [];
                for (let file of photoFiles) {
                    const storageRef = storage.ref(`images/${Date.now()}_${file.name}`);
                    await storageRef.put(file);
                    imageUrls.push(await storageRef.getDownloadURL());
                }
                const itemData = {
                    author: document.getElementById('author').value, name: name, category: document.getElementById('input-category').value,
                    location: document.getElementById('location').value, phone: document.getElementById('phone').value,
                    itemUrl: document.getElementById('itemUrl').value, memo: document.getElementById('memo').value,
                    prices: prices, rating: document.getElementById('rating-val').value,
                    sushiFish: document.getElementById('sushi-fish').value, sushiVinegar: document.getElementById('sushi-vinegar').value,
                    hotelInterior: document.getElementById('hotel-interior').value, hotelMeal: document.getElementById('hotel-meal').value,
                    barcode: document.getElementById('barcode-val').value || "", timestamp: Date.now()
                };
                if(imageUrls.length > 0) itemData.imageUrls = imageUrls;
                const ref = editingId ? database.ref('items/' + editingId) : database.ref('items').push();
                await ref.update(itemData);
                saveBtn.innerText = "å®Œäº†ï¼";
                setTimeout(() => { saveBtn.disabled = false; if (editingId) startBrowseMode(); else goHome(); resetForm(); }, 800);
            } catch (e) { alert("ã‚¨ãƒ©ãƒ¼: " + e.message); saveBtn.disabled = false; saveBtn.innerText = "ä¿å­˜"; }
        }

        function displayData() {
            database.ref('items').on('value', (snapshot) => {
                const container = document.getElementById('list-container');
                container.innerHTML = '';
                const data = snapshot.val();
                if (!data) return;
                Object.keys(data).reverse().forEach(key => {
                    const item = data[key];
                    if (item.category !== currentTab) return;

                    const stars = `<div class="text-yellow-500 text-xs mt-1 font-bold">` + "â­".repeat(item.rating || 0) + `</div>`;
                    let priceHtml = '';
                    if (item.prices && item.prices.length > 0) {
                        priceHtml = `<div class="grid grid-cols-1 gap-2 mt-3">` + item.prices.map(p => `
                            <div class="p-3 bg-gray-50 rounded-xl border border-gray-100 flex justify-between items-center shadow-sm font-bold">
                                <div class="truncate mr-2 font-bold"><div class="text-[11px] text-gray-800">${p.shop || 'ä¸æ˜'}</div>${p.loc ? `<a href="${p.loc}" target="_blank" class="text-[9px] text-blue-500 underline">ğŸ”— ãƒšãƒ¼ã‚¸</a>` : ''}</div>
                                <div class="text-emerald-600 text-sm">Â¥${Number(p.price).toLocaleString()}</div>
                            </div>`).join('') + `</div>`;
                    }

                    const mapUrl = `https://www.google.co.jp/maps/search/${encodeURIComponent(item.name + ' ' + (item.location || ''))}`;
                    let special = '';
                    let locationLabel = '';
                    
                    if (item.category === 'hotel') {
                        special = `<div class="mt-3 space-y-1 font-bold">${item.hotelInterior ? `<div class="p-2 bg-indigo-50 rounded-lg text-[10px] text-indigo-700">ğŸ–¼ï¸ ${item.hotelInterior}</div>` : ''}${item.hotelMeal ? `<div class="p-2 bg-orange-50 rounded-lg text-[10px] text-orange-700">ğŸ´ ${item.hotelMeal}</div>` : ''}</div>`;
                        if(item.location) locationLabel = `<a href="${mapUrl}" target="_blank" class="text-blue-600 text-[10px] underline">ğŸ“ åœ°å›³ã‚’è¦‹ã‚‹</a>`;
                    } else if (item.category === 'sushi') {
                        special = `<div class="mt-2 p-2 bg-red-50 rounded-lg text-[10px] text-red-700 font-bold">ğŸŸ ç¨®é¡: ${item.sushiFish || '-'} / ğŸš é…¢: ${item.sushiVinegar || '-'}</div>`;
                        // ã€ä¿®æ­£ã€‘å¯¿å¸ã‚¿ã‚°ã®ã¿ãƒªãƒ³ã‚¯ã‚’å¤–ã—ã€ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã«
                        if(item.location) locationLabel = `<div class="text-gray-600 text-[10px] font-bold">ğŸ£ åº—å: ${item.location}</div>`;
                    } else if (item.category === 'gourmet' && item.location) {
                        locationLabel = `<a href="${mapUrl}" target="_blank" class="text-blue-600 text-[10px] underline">ğŸ“ åœ°å›³ã‚’è¦‹ã‚‹</a>`;
                    }

                    const div = document.createElement('div');
                    div.className = 'bg-white rounded-3xl shadow-sm border p-5 text-left mb-6 font-bold';
                    div.innerHTML = `
                        ${item.imageUrls ? `<div class="image-grid mb-4">${item.imageUrls.map(url => `<img src="${url}" class="w-full h-24 object-cover rounded-xl shadow-sm">`).join('')}</div>` : ''}
                        <div class="flex justify-between items-center mb-1 font-bold"><span class="text-[10px] text-emerald-600">ğŸ‘¤ ${item.author}</span><div class="space-x-3 text-[10px]"><button onclick="editItem('${key}')" class="text-blue-500">ç·¨é›†</button><button onclick="deleteItem('${key}')" class="text-red-400">å‰Šé™¤</button></div></div>
                        <h3 class="font-bold text-lg leading-tight">${item.name}</h3>
                        ${stars}
                        ${priceHtml}
                        ${special}
                        <div class="flex gap-4 mt-3 mb-1">
                            ${locationLabel}
                            ${(item.category !== 'sushi' && item.itemUrl) ? `<a href="${item.itemUrl}" target="_blank" class="text-orange-600 text-[10px] underline font-bold">ğŸ›’ é€šè²©ã‚µã‚¤ãƒˆ</a>` : ''}
                        </div>
                        <div class="mt-3 bg-emerald-50/50 p-4 rounded-xl text-xs text-gray-600">${item.memo || ''}</div>
                    `;
                    container.appendChild(div);
                });
            });
        }

        function editItem(key) {
            database.ref('items/' + key).once('value').then(snap => {
                const item = snap.val(); editingId = key; startManualMode();
                document.getElementById('input-category').value = item.category;
                toggleCategoryFields(item.category);
                document.getElementById('name').value = item.name || '';
                document.getElementById('location').value = item.location || '';
                document.getElementById('phone').value = item.phone || '';
                document.getElementById('itemUrl').value = item.itemUrl || '';
                document.getElementById('memo').value = item.memo || '';
                document.getElementById('rating-val').value = item.rating || 3;
                document.getElementById('sushi-fish').value = item.sushiFish || '';
                document.getElementById('sushi-vinegar').value = item.sushiVinegar || '';
                document.getElementById('hotel-interior').value = item.hotelInterior || '';
                document.getElementById('hotel-meal').value = item.hotelMeal || '';
                const priceContainer = document.getElementById('price-entry-list');
                priceContainer.innerHTML = '';
                if(item.prices) item.prices.forEach(p => addPriceField(p));
                document.getElementById('save-btn').disabled = false;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        function resetForm() { 
            const ids = ['name','location','phone','itemUrl','memo','photo','sushi-fish','sushi-vinegar','hotel-interior','hotel-meal','barcode-val'];
            ids.forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = ''; }); 
            document.getElementById('price-entry-list').innerHTML = ''; 
            document.getElementById('rating-val').value = 3; 
            document.getElementById('save-btn').disabled = false;
            editingId = null; 
        }

        function startCameraMode() { document.getElementById('section-home').classList.add('hidden'); document.getElementById('section-camera').classList.remove('hidden'); const h = new Html5Qrcode("reader"); document.getElementById('reader').style.display = 'block'; h.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (d) => { h.stop(); document.getElementById('reader').style.display = 'none'; checkExistingProduct(d); }); }
        async function checkExistingProduct(b) { const s = await database.ref('items').orderByChild('barcode').equalTo(b).once('value'); if(s.val()) { editingId = Object.keys(s.val())[0]; editItem(editingId); return; } try { const res = await fetch(`https://world.openfoodfacts.org/api/v0/product/${b}.json`); const data = await res.json(); startManualMode(); document.getElementById('barcode-val').value = b; document.getElementById('input-category').value = 'item'; toggleCategoryFields('item'); if (data.status === 1 && data.product.product_name) document.getElementById('name').value = data.product.product_name; } catch (e) { startManualMode(); document.getElementById('barcode-val').value = b; toggleCategoryFields('item'); } }
        function searchJAN() { window.open(`https://www.google.com/search?q=${document.getElementById('barcode-val').value}`, '_blank'); }
        function switchTab(tab) { currentTab = tab; document.querySelectorAll('nav button').forEach(btn => btn.className = 'px-3 py-1 whitespace-nowrap text-sm text-gray-400 font-bold'); document.getElementById(`tab-${tab}`).className = 'px-3 py-1 whitespace-nowrap active-tab text-sm font-bold'; displayData(); }
        function deleteItem(k) { if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) database.ref('items/' + k).remove(); }
        async function processOCR(i) { if (!i.files[0]) return; document.getElementById('ocr-status').innerText = "â³ è§£æä¸­..."; const r = await Tesseract.recognize(i.files[0], 'jpn'); document.getElementById('memo').value += "\n" + r.data.text; document.getElementById('ocr-status').innerText = "âœ… å®Œäº†"; }
    </script>
</body>
</html>
